Scoring
=======

These are the sections in this page:

    :ref:`chrome-addons`

Ensure that you have the latest version of the *phoenix_bbonames.txt* file on your computer (see [The *phoenix_bbonames.txt* file](bbo_names)).

The procedures must be carried out in the order in which they appear below.

**NB** If for any reason you do not intend to send a player's results to the EBU, then temporarily change their EBU number in the *phoenix_bbonames.txt* file to **888888**.

If you need to **adjust scores** this can be done during the scoring process before the *BBO to XML converter* (see BBO_XML_ below).

.. _upload_bridgewebs:

Upload scores to BridgeWebs
---------------------------

Launch the Chrome browser and open the urls shown at :ref:`chrome-addons` in different tabs.

1. Navigate to the club's BBO Tournament list at:

    `http://webutil.bridgebase.com/v2/tarchive.php?m=h&h=vEBU211328&d=vEBU211328 <http://webutil.bridgebase.com/v2/tarchive.php?m=h&h=vEBU211328&d=vEBU211328>`_

    You might have to login using the director's login (vEBU211328) and password.

    This will list the club's tournaments (they stay here for one week only).

    .. figure:: /images/scoring_01.png
        :height: 63 pt
        :width: 500 pt
        :alt: Find tournament
        :figclass: align-center
        :name: scoring_01

        Find tournament

2. Click on *boards* against the tournament you want (check the date).

    It might indicate that the scores are not ready. We have no control over when BBO make the files available, but it should be within a few hours.

    When the results are available you will see a screen similar to :numref:`scoring_02a` List travellers:

    .. figure:: /images/scoring_02a.png
        :height: 227 pt
        :width: 500 pt
        :alt: List travellers
        :figclass: align-center
        :name: scoring_02a

        List travellers

3. Check later boards to make sure there are no averages. Adjust if necessary.

4. Take the 15 character code in the heading of the board list after *Tourney*

    (e.g. *9779-1591639307*).  Concatenate it with the URL:

    `http://webutil.bridgebase.com/v2/tview.php?t= <http://webutil.bridgebase.com/v2/tview.php?t=>`_

    to give (for example) a link similar to:

    .. code-block:: text

        http://webutil.bridgebase.com/v2/tview.php?t=9779-1591639307

    Use this created URL to navigate to a screen similar to :numref:`scoring_03` Pairs scores:

    .. figure:: /images/scoring_03.png
        :height: 406 pt
        :width: 582 pt
        :alt: List travellers
        :figclass: align-center
        :name: scoring_03

        Pairs scores

    .. _create_scorecard:

5. Click on the *BBX* icon in the browser (top right).

The *BBO Running* alert will appear

.. figure:: /images/scoring_10.png
    :height: 93 pt
    :width: 212 pt
    :alt: BBO Running
    :figclass: align-center
    :name: bbo_running

    BBO Running

This process generates a scorecard every few seconds and the screen will flash alarmingly for some seconds.

When it's finished you will see a dialog box

.. figure:: /images/bbo_extractor.png
    :height: 87 pt
    :width: 226 pt
    :alt: BBO Extractor
    :figclass: align-center
    :name: bbo_extractor

    BBO Extractor

Click on *OK* and you will see the final dialog

6. You will see the *Calculation of makeable contracts* alert.

.. figure:: /images/scoring_07.png
    :height: 147 pt
    :width: 260 pt
    :alt: PBN File Extractor
    :figclass: align-center
    :name: pbn_extractor

    PBN File Extractor

7. The following two files should now be in your *Downloads* directory:

    * <tournament name and date>.csv
    * <tournament name and date>.pbn

    Check that they are there. If not, re-run the conversion.

.. _bbo_xml_converter:

.. _BBO_XML:

8. Open the BBO to XML converter `https://dds.bridgewebs.com/bbotoxml/bbotoxml.htm?p=1 <https://dds.bridgewebs.com/bbotoxml/bbotoxml.htm?p=1>`_.


    If any scores need adjustment, **do it now**!

    a. Click on *Review/Edit CSV* in the top left of the form. You will be asked to select a file, and it should be the *<tournament name and date>.csv* file created in stage 7 above.

    .. figure:: /images/scoring_08.png
        :height: 176 pt
        :width: 450 pt
        :alt: XML Converter
        :figclass: align-center
        :name: scoring_08

        Select file for editing

    b. Click on *Edit Scores*.

    .. figure:: /images/scoring_09.png
        :height: 204 pt
        :width: 433 pt
        :alt: XML Converter
        :figclass: align-center
        :name: scoring_09

        Edit a score

    c. Make the changes you need to, and click on *Save CSV*. You may the proceed as below.


9.    Complete the fields as shown (except *Master Points*). Note that the *Club ID number* is the 6 character EBU number, and the *UMS Charge Rate* should be 10. Enter your name as the Contact.

    Click on the *Load Names* button and open the *phoenix_bbonames.txt* file when requested. When done it will show
    a message: *xx names loaded* where *xx* is the number of names in *phoenix_bbonames.txt*.

    .. figure:: /images/scoring_04.png
        :height: 297 pt
        :width: 450 pt
        :alt: XML Converter
        :figclass: align-center
        :name: scoring_04

        XML Converter

(The order of the fields on this page might vary - check)

10. Click on *Create XML file* and select the relevant **csv** file from the downloads folder.

    This will create an *XML* file named *<tournament name and date>_UMS.xml* (this will be used in :ref:`Sending P2P to EBU <sending_p2p>` below).

    Check that the file is in your *Downloads* directory, if not, re-run.

11. Click on *Create XML for Bridgewebs* and again select the csv file.

    This will create a second *XML* file in downloads named *<tournament name and date>.xml* (this will be used in the next section).

    Check that the file is in your *Downloads* directory, if not, re-run.

    Note, there are two *xml* files with similar names: one with *UMS* and one without.

12. Navigate to the Phoenix Bridgewebs site at `https://www.bridgewebs.com/phoenix <https://www.bridgewebs.com/phoenix/>`_,
and click on *Administration* in the left-hand menu. Enter the BridgeWebs password.


.. figure:: /images/scoring_05.png
    :height: 208 pt
    :width: 508 pt
    :alt: Results to Bridgewebs
    :figclass: align-center
    :name: scoring_05

    Results to Bridgewebs

Here, you will be selecting files from from your *Downloads* directory.

Against *Select the Results file*, select *<tournament name and date>.xml*.

Against *Select the Deal File*, select *<tournament name and date>.pbn*.

You can navigate around the scores and boards to satisfy yourself that the upload has worked correctly.

**NB** this can be repeated if, for example, some names are missing from the *phoenix_bbonames.txt* file.

.. _sending_p2p:

Sending P2P to EBU
------------------

1. On the EBU website at `https://www.ebu.co.uk <https://www.ebu.co.uk>`_, click on *My EBU*;

2. Enter the club EBU number and password;

3. Click on the *submit* tab on the top-right. Use *Browse* to select the file:

    *<tournament name and date>_UMS.xml*

    from your *Downloads* directory;

4. Click on *Upload*.

5. You might get a request to resolve unknown players (for example if you have used substitutes) - they are guests

Cleaning up used files
----------------------

When you are satisfied that the results have all been uploaded, it might be as well to remove the work files from
your *Downloads* directory. This is to avoid any confusion in future weeks because
the file names will look similar. The files to remove are:

1. *<tournament name and date>.pbn*

2. *<tournament name and date>.xml*

3. *<tournament name and date>_UMS.xml*

4. *<tournament name and date>.csv*

And that is it for that tournament!
